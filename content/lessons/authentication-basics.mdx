---
title: Authentication Basics
chapterSlug: authentication
duration: 15
order: 1
---

## Authentication in Rails

Authentication is how you verify who a user is. Rails provides tools to build authentication from scratch or use gems like Devise.

## Rails 8+ Built-in Authentication

Rails 8 includes a built-in authentication generator:

```bash
rails generate authentication
```

This creates:
- User model with secure password
- Session controller
- Password reset functionality
- Current model for accessing the current user

## Building Authentication from Scratch

### 1. Create User Model

```bash
rails generate model User email:string:uniq password_digest:string
rails db:migrate
```

### 2. Add has_secure_password

```ruby
# app/models/user.rb
class User < ApplicationRecord
  has_secure_password
  
  validates :email, presence: true, 
                    uniqueness: { case_sensitive: false },
                    format: { with: URI::MailTo::EMAIL_REGEXP }
  validates :password, length: { minimum: 8 }, if: :password_required?
  
  before_save :downcase_email
  
  def self.authenticate_by(email:, password:)
    user = find_by(email: email.downcase)
    user&.authenticate(password) || nil
  end
  
  private
  
  def downcase_email
    self.email = email.downcase
  end
  
  def password_required?
    password_digest.nil? || password.present?
  end
end
```

Add bcrypt to your Gemfile:

```ruby
# Gemfile
gem 'bcrypt', '~> 3.1.7'
```

### 3. Create Sessions Controller

```ruby
# app/controllers/sessions_controller.rb
class SessionsController < ApplicationController
  def new
    # Login form
  end
  
  def create
    user = User.authenticate_by(
      email: params[:email],
      password: params[:password]
    )
    
    if user
      session[:user_id] = user.id
      redirect_to root_path, notice: 'Logged in successfully!'
    else
      flash.now[:alert] = 'Invalid email or password'
      render :new, status: :unprocessable_entity
    end
  end
  
  def destroy
    session.delete(:user_id)
    redirect_to root_path, notice: 'Logged out successfully!'
  end
end
```

### 4. Create Registration Controller

```ruby
# app/controllers/registrations_controller.rb
class RegistrationsController < ApplicationController
  def new
    @user = User.new
  end
  
  def create
    @user = User.new(user_params)
    
    if @user.save
      session[:user_id] = @user.id
      redirect_to root_path, notice: 'Account created successfully!'
    else
      render :new, status: :unprocessable_entity
    end
  end
  
  private
  
  def user_params
    params.require(:user).permit(:email, :password, :password_confirmation)
  end
end
```

### 5. Add Routes

```ruby
# config/routes.rb
Rails.application.routes.draw do
  get 'signup', to: 'registrations#new'
  post 'signup', to: 'registrations#create'
  
  get 'login', to: 'sessions#new'
  post 'login', to: 'sessions#create'
  delete 'logout', to: 'sessions#destroy'
  
  # Or RESTful:
  resource :session, only: [:new, :create, :destroy]
  resource :registration, only: [:new, :create]
end
```

### 6. Application Controller Helpers

```ruby
# app/controllers/application_controller.rb
class ApplicationController < ActionController::Base
  helper_method :current_user, :logged_in?
  
  private
  
  def current_user
    @current_user ||= User.find_by(id: session[:user_id]) if session[:user_id]
  end
  
  def logged_in?
    current_user.present?
  end
  
  def authenticate_user!
    unless logged_in?
      redirect_to login_path, alert: 'Please log in to continue'
    end
  end
end
```

### 7. Protecting Controllers

```ruby
class ArticlesController < ApplicationController
  before_action :authenticate_user!, except: [:index, :show]
  
  def new
    @article = current_user.articles.build
  end
  
  def create
    @article = current_user.articles.build(article_params)
    # ...
  end
end
```

## Login Form

```erb
<!-- app/views/sessions/new.html.erb -->
<h1>Log In</h1>

<%= form_with url: login_path, local: true do |f| %>
  <div class="field">
    <%= f.label :email %>
    <%= f.email_field :email, autofocus: true, required: true %>
  </div>
  
  <div class="field">
    <%= f.label :password %>
    <%= f.password_field :password, required: true %>
  </div>
  
  <div class="field">
    <%= f.check_box :remember_me %>
    <%= f.label :remember_me, "Remember me" %>
  </div>
  
  <%= f.submit "Log In" %>
<% end %>

<p>
  Don't have an account? <%= link_to "Sign up", signup_path %>
</p>
```

## Registration Form

```erb
<!-- app/views/registrations/new.html.erb -->
<h1>Sign Up</h1>

<%= form_with model: @user, url: signup_path do |f| %>
  <% if @user.errors.any? %>
    <div class="errors">
      <% @user.errors.full_messages.each do |msg| %>
        <p><%= msg %></p>
      <% end %>
    </div>
  <% end %>
  
  <div class="field">
    <%= f.label :email %>
    <%= f.email_field :email, autofocus: true %>
  </div>
  
  <div class="field">
    <%= f.label :password %>
    <%= f.password_field :password %>
  </div>
  
  <div class="field">
    <%= f.label :password_confirmation %>
    <%= f.password_field :password_confirmation %>
  </div>
  
  <%= f.submit "Sign Up" %>
<% end %>
```

## Navigation with Auth Links

```erb
<!-- app/views/shared/_navigation.html.erb -->
<nav>
  <%= link_to "Home", root_path %>
  
  <% if logged_in? %>
    <span>Welcome, <%= current_user.email %></span>
    <%= link_to "Profile", profile_path %>
    <%= button_to "Log Out", logout_path, method: :delete %>
  <% else %>
    <%= link_to "Log In", login_path %>
    <%= link_to "Sign Up", signup_path %>
  <% end %>
</nav>
```

## Remember Me (Persistent Session)

```ruby
class User < ApplicationRecord
  has_secure_password
  has_secure_token :remember_token
end

class SessionsController < ApplicationController
  def create
    user = User.authenticate_by(email: params[:email], password: params[:password])
    
    if user
      if params[:remember_me] == "1"
        user.regenerate_remember_token
        cookies.permanent.encrypted[:remember_token] = user.remember_token
      end
      session[:user_id] = user.id
      redirect_to root_path
    else
      # ...
    end
  end
  
  def destroy
    cookies.delete(:remember_token)
    session.delete(:user_id)
    redirect_to root_path
  end
end

class ApplicationController < ActionController::Base
  def current_user
    @current_user ||= if session[:user_id]
      User.find_by(id: session[:user_id])
    elsif cookies.encrypted[:remember_token]
      User.find_by(remember_token: cookies.encrypted[:remember_token])
    end
  end
end
```

This is the foundation for user authentication in Rails!

